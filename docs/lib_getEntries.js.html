<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lib/getEntries.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Tutorials</li><li class="nav-item"><a href="tutorial-get-debe.html">Debe</a></li><li class="nav-item"><a href="tutorial-get-entries.html">Entries</a></li><li class="nav-item"><a href="tutorial-get-entry.html">Entry</a></li><li class="nav-item"><a href="tutorial-get-today-in-history.html">Today in History</a></li><li class="nav-item"><a href="tutorial-get-user.html">User</a></li><li class="nav-item"><a href="tutorial-vote.html">Vote</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NotFoundError.html">NotFoundError</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VoteError.html">VoteError</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#downvote">downvote</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getDebe">getDebe</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getEntries">getEntries</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getEntryById">getEntryById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getTodayInHistory">getTodayInHistory</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getUser">getUser</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#upvote">upvote</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/getEntries.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const r = require('../utils/request')
const d = require('../utils/date')
const urls = require('../utils/urls')
const e = require('../exceptions')
const { upvote, downvote } = require('./vote')

/**
 * A promise for entries.
 *
 * @promise Entries
 * @fulfill {Object} The entries.
 * @reject {NotFoundError} Throws when entries not found.
 */

/**
 * Fetch entries.
 *
 * @param   {string}  title             Title itself.
 * @param   {Object}  usrOptions        Parameters that user can specify.
 * @param   {number}  usrOptions.page   Page number of title.
 *
 * @return {Entries} A promise for the entries.
 */
const getEntries = (title, usrOptions) => {
  return new Promise((resolve, reject) => {
    let { page } = usrOptions

    if (!page) page = 1

    const endpoint = '/?q=' + title + '&amp;p=' + page

    r(endpoint, ($) => {
      const status = $.statusCode
      const entries = []

      if (status === 200) {
        $('ul#entry-item-list li').each(function (i, elm) {
          const date = d($(elm).find('a.entry-date').text())
          const isEksiseylerExist = $(elm).data('seyler-slug') !== ''

          entries.push({
            author: $(elm).data('author'),
            author_id: $(elm).data('author-id'),
            author_url: urls.user + $(elm).data('author'),
            content: $(elm).find('div.content').html(),
            content_encoded: $(elm).find('div.content').text().trim(),
            date_created: date.created,
            date_modified: date.modified,
            eksiseyler_link: isEksiseylerExist ? urls.seyler + $(elm).data('seyler-slug') : null,
            eksiseyler_slug: isEksiseylerExist ? $(elm).data('seyler-slug') : null,
            entry_id: $(elm).data('id'),
            favorite_count: $(elm).data('favorite-count'),
            permalink: urls.base + $(elm).find('a.entry-date').attr('href'),
            title: $('h1#title').data('title'),
            title_id: $('h1#title').data('id'),
            title_slug: $('h1#title').data('slug'),
            title_url: urls.base + $('h1#title a').attr('href'),
            upvote,
            downvote
          })
        })
        resolve(entries)
      } else if (status === 404) {
        reject(new e.NotFoundError('Entries not found.'))
      } else {
        reject(new Error('An unknown error occurred.'))
      }
    })
  })
}

module.exports = getEntries
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Tue Oct 27 2020 13:20:35 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
